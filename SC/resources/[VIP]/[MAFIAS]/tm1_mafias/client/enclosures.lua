local enclosures = {
	[1] = {
        name = "Los Families", -- MAFIA
        weapon   = 	{x = 0, y = 0, z = 0},
        garage   = 	{x = -92.99, y = -1607.52, z = 31.31},
        spawnCar = 	{x = -116.32, y = -1607.87, z = 30.79},
        saveCar  = 	{x = -108.77, y = -1607.52, z = 31.31},
        attack   = 	{x = -14.3532, y = -1441.93, z = 31.101},
        armeria  = 	{x = -109.26, y = -1628.63, z = 31.82},
        owner = nil
    }, 
	[2] = {
        name = "Los Marabunta", -- MAFIA
        weapon   = 	{x = 0, y = 0, z = 0},
        garage   = 	{x = 1298.417, y = -1709.501, z = 55.08668},
        spawnCar = 	{x = 1300.479, y = -1704.164, z = 55.11494},
        saveCar  = 	{x = 1304.891, y = -1712.4886, z = 54.6887},
        attack   = 	{x = 1184.152, y = -1620.73, z = 44.853},
        armeria  = 	{x = 1294.168, y = -1699.011, z = 55.07861},
        
		owner = nil
    },
	[3] = {
		name = "Los Ballas", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = 84.42994, y = -1967.45, z = 20.747},
		spawnCar = 	{x = 88.42, y = -1965.896, z = 20.648},
		saveCar  = 	{x = 84.82375, y = -1972.76, z = 20.834},
		attack   = 	{x = 85.73605, y = -1956.60, z = 20.747},
		armeria  = 	{x = 85.73605, y = -1956.60, z = 20.747},

		owner = nil
	},
	[4] = {
		name = "Los BloodZ", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = 338.55, y = -2036.92, z = 21.39},
		spawnCar = 	{x = 333.74, y = -2039.0, z = 21.07},
		saveCar  = 	{x = 331.57, y = -2044.51, z = 20.8},
		armeria  = 	{x = 332.1910, y = -2018.36, z = 22.354},
		attack   = 	{x = 332.22, y = -2021.0, z = 21.74},

		owner = nil
	},
	[5] = {
		name = "Los Vagos", -- MAFIA
		weapon 	 = 	{x = 0, y = 0, z = 0},
		garage 	 = 	{x = -1066.39, y = -1667.38, z = 4.53},
		spawnCar = 	{x = -1069.79, y = -1671.0, z = 4.45},
		saveCar  = 	{x = -1065.61, y = -1664.61, z = 4.55},
		attack   = 	{x = -1088.39, y = -1672.29, z = 4.7},
		armeria  = 	{x = -1088.39, y = -1672.29, z = 4.7},

		owner = nil
	},
	[6] = {
		name = "Los Aztecas", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = 1391.049, y = -606.160, z = 73.337},
		spawnCar = 	{x = 1377.751, y = -595.982, z = 73.337},
		saveCar  = 	{x = 1382.537, y = -599.901, z = 73.337},
		attack   = 	{x = 1522.484, y = 6329.299, z = 24.606},
		armeria  = 	{x = 1386.164, y = -593.3045, z = 74.06},

		owner = nil
	},
	[7] = {
		name = "Los Profesionales", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = 979.75, y = -1831.03, z = 31.35},
		spawnCar = 	{x = 984.43, y = -1821.63, z = 31.16},
		saveCar  = 	{x = 986.6, y = -1827.16, z = 31.13},
		attack   = 	{x = 967.76, y = -1828.53, z = 171.67},
		armeria  = 	{x =  967.76, y = -1828.53, z = 31.131},

		owner = nil
	},
	[8] = {
		name = "Equipo A", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = 732.78, y = -1089.811, z = 22.47},
		spawnCar = 	{x = 731.7809, y = -1089.81, z = 22.43},
		saveCar  = 	{x = 734.6398, y = -1082.862, z = 22.163},
		attack   = 	{x = 138.8582, y = -762.443, z = 45.751},
		armeria  = 	{x = 726.0030, y = -1066.12, z = 28.311},

		owner = nil
	},
	[9] = {
		name = "Bandoleros", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = -416.7143, y = -1683.208, z = 19.02908},
		spawnCar = 	{x = -425.966, y = -1687.497, z = 19.02907},
		saveCar  = 	{x = -425.5863, y = -1679.097, z = 19.02907},
		attack   = 	{x = -424.5863, y = -1672.097, z = 112.02907},
		armeria  = 	{x = -440.5778, y = -1693.647, z = 19.21154},

		owner = nil
	},
	[10] = {
		name = "Vory V Zakone", -- MAFIA
		weapon   = 	{x = 0, y = 0, z = 0},
		garage   = 	{x = -810.71, y = 167.95, z = 72.23},
		spawnCar = 	{x = -829.82, y = 170.51, z = 70.15},
		saveCar  = 	{x = -824.29, y = 157.09, z = 69.74},
		attack   = 	{x = -817.54, y = 177.91, z = 72.22},
		armeria  = 	{x = -803.296, y = 184.9711, z = 72.605},

		owner = nil
	},
	[11] = {
        name = "The Lost", -- MAFIA
        weapon   = 	{x = 0, y = 0, z = 0},
        garage   = 	{x = 976.07, y = -126.73, z = 74.25},
        spawnCar = 	{x = 974.01, y = -139.17, z = 74.25},
        saveCar  = 	{x = 986.2, y = -138.53, z = 73.03},
        attack   = 	{x = 982.35, y = -103.85, z = 74.85},
		armeria  = 	{x = 976.5618, y = -103.154, z = 74.845},

        owner = nil
    },
	[12] = {
        name = "La Cruz", -- MAFIA
        weapon   = 	{x = 0, y = 0, z = 0},
        garage   = 	{x = 537.291,  y = -1758.607, z = 29.09264},
        spawnCar = 	{x = 531.3364, y = -1754.242, z = 29.07381},
        saveCar  = 	{x = 526.9164, y = -1751.271, z = 29.04471},
        attack   = 	{x = -442.336, y = -1696.34,  z = 18.944},
		armeria  = 	{x = 480.2448, y = -1737.293, z = 29.15102},

        owner = nil
    },
}

function OpenMenuGarage(coords)
	local elements = {}
	if group.groupid == 1 then
		table.insert(elements,{label = "BANDA 1", value = "bf400"})
		table.insert(elements,{label = "BANDA 1", value = "dubsta2"})
		elseif group.groupid == 2 then
		table.insert(elements,{label = "BANDA 2", value = "bf400"})
		table.insert(elements,{label = "BANDA 2", value = "burrito3"})
		elseif group.groupid == 3 then
		table.insert(elements,{label = "BANDA 3", value = "bf400"})
		table.insert(elements,{label = "BANDA 3", value = "trophytruck"})
		elseif group.groupid == 4 then
		table.insert(elements,{label = "BANDA 4", value = "dubsta2"})
		table.insert(elements,{label = "BANDA 4", value = "bf400"})
		elseif group.groupid == 5 then
		table.insert(elements,{label = "BANDA 5", value = "bf400"})
		table.insert(elements,{label = "BANDA 5", value = "buccaneer2"})
		elseif group.groupid == 6 then
		table.insert(elements,{label = "BANDA 6", value = "bf400"})
		table.insert(elements,{label = "BANDA 6", value = "mesa"})
		elseif group.groupid == 7 then
		table.insert(elements,{label = "BANDA 7", value = "baller7"})
		table.insert(elements,{label = "BANDA 7", value = "bf400"})
		elseif group.groupid == 8 then
		table.insert(elements,{label = "BANDA 8", value = "bentaygast"})
		table.insert(elements,{label = "BANDA 8", value = "africat"})
		elseif group.groupid == 9 then
		table.insert(elements,{label = "BANDA 9", value = "bf400"})
		table.insert(elements,{label = "BANDA 9", value = "brawler"})
		elseif group.groupid == 10 then
		table.insert(elements,{label = "BANDA 10", value = "baller2"})
		table.insert(elements,{label = "BANDA 10", value = "bf400"})
		elseif group.groupid == 11 then	
		table.insert(elements,{label = "BANDA 11", value = "gburrito"})
		table.insert(elements,{label = "BANDA 11", value = "nightblade"})
		elseif group.groupid == 12 then
		table.insert(elements,{label = "BANDA 12", value = "bf400"})
		table.insert(elements,{label = "BANDA 12", value = "dubsta2"})
		end
	

	ESX.UI.Menu.CloseAll()

	ESX.UI.Menu.Open(
		'default', GetCurrentResourceName(), 'seller_to',
		{
			title  = '<b><span style="color: Gold;">SACAR VEHICULO</span></b>',
			align    = 'bottom-right',
			elements = elements
		},
		function(data, menu)	
			if data.current.value then
				if GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), coords.x,coords.y,coords.z, true) > 30.5	then		
					ESX.ShowNotification("Como quieres sacar el vehiculo tan lejos del garaje...")
				else
					SpawnVehicle(data.current.value, coords)
				end
				menu.close()

			else
				menu.close()
			end
		end,
		function(data, menu)
			menu.close()
		end
	)
end


local seconds = 0
local isStarted = 0
local isIn = false
local isPosible = true


AddEventHandler('playerSpawned', function(spawn)
	local enclosuresa = {}
	for _, info in pairs(enclosures) do
	    enclosuresa[_] = info.name      	
	end
	TriggerServerEvent('tm1_mafias:enclosureComprobate',enclosuresa)
end)
local enclosuresa = {}
	for _, info in pairs(enclosures) do
	    enclosuresa[_] = info.name      	
	end
TriggerServerEvent('tm1_mafias:enclosureComprobate',enclosuresa)

RegisterNetEvent('tm1_mafias:puttedGroupsInEnclosures')
AddEventHandler('tm1_mafias:puttedGroupsInEnclosures',function()
	Citizen.CreateThread(function()
		local enclosuresa = {}
		for _, info in pairs(enclosures) do
	      	enclosuresa[_] = info.name      	
	    end
	    TriggerServerEvent('tm1_mafias:enclosureComprobate',enclosuresa)
	end)
end)

--===========
-- AÑADIENDO DATOS A EL ENCLOUSERS
--===========
RegisterNetEvent('tm1_mafias:putGroupsInEnclosures')
AddEventHandler('tm1_mafias:putGroupsInEnclosures',function(enclosuresInfo)
	for i,v in pairs(enclosuresInfo) do
		for a,b in pairs(enclosures) do
			if v.name == b.name then
				b.owner = v.groupid
			end
		end
	end
	if isStarted == 1 then

	else
		varReady()
		isStarted = 1
	end
	
end)

RegisterNetEvent('tm1_mafias:changeIsPosible')
AddEventHandler('tm1_mafias:changeIsPosible',function(isPosiblea)
	isPosible = isPosiblea
end)

--===========
-- BORRAR VEHÍCULO
--===========
RegisterNetEvent('tm1_mafias:clearV')
AddEventHandler('tm1_mafias:clearV',function(x,y,z)
	local vehicleu = GetClosestVehicle(x,y,z, 6.5, 0, 70)
	SetEntityAsMissionEntity( vehicleu, true, true )
	Citizen.InvokeNative( 0xEA386986E786A54F, Citizen.PointerValueIntInitialized( vehicleu ) )
end)

--===========
-- HILO PRINCIPAL
--===========

function SpawnVehicle(vehicle, coords)
	local player = PlayerPedId()
	local vehicle = GetHashKey(vehicle)
	RequestModel(vehicle)
	while not HasModelLoaded(vehicle) do
		Citizen.Wait(0)
	end
	local plate = exports['esx_vehicleshop']:GeneratePlate()

	local spawned_car = CreateVehicle(vehicle, coords.x,coords.y,coords.z, true, true)
	SetPedIntoVehicle(player, spawned_car, -1)
	SetVehicleNumberPlateText(spawned_car,plate)
	TriggerEvent("fuel:setFuel",spawned_car,100.0)


end
function varReady()
	Citizen.CreateThread(function ()
		while true do
			local interval = 250
			
			local coords = GetEntityCoords(GetPlayerPed(-1))
			if not(group.enclosure == nil) then
				for i,v in pairs(enclosures) do
					if v.name == group.enclosure then
						if GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.garage.x,v.garage.y,v.garage.z, true) < 1.5 then
							interval = 0
							DrawMarker(1,v.garage.x,v.garage.y,v.garage.z - 1, 0, 0, 0, 0, 0, 0, 1.5001, 1.5001, 0.6001,255,0,0, 200, 0, 0, 0, 0)
							drawTxt("PULSA E PARA ABRIR EL GARAJE",1, 1, 0.5, 0.9, 0.75,255,0,0,255)
							if IsControlJustReleased(0, 38) then
								local coords = {x = v.spawnCar.x,y = v.spawnCar.y,z = v.spawnCar.z}
								local coords1 = {x = v.saveCar.x,y = v.saveCar.y,z = v.saveCar.z}
								OpenMenuGarage(coords)
							end
						elseif GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.armeria.x,v.armeria.y,v.armeria.z, true) < 1.5 then
							interval = 0
							DrawMarker(1,v.armeria.x,v.armeria.y,v.armeria.z - 1, 0, 0, 0, 0, 0, 0, 1.5001, 1.5001, 0.6001,255,0,0, 200, 0, 0, 0, 0)
							drawTxt("PULSA E PARA ABRIR EL ARMARIO",1, 1, 0.5, 0.9, 0.75,255,0,0,255)
							if IsControlJustReleased(0, 38) then
								if group.armariosaproved == 1 then 
									OpenMenus()	
								else 
									ESX.ShowNotification("Tu banda no tiene privilegio en la ciudad.")
								end
							end
						elseif GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.spawnCar.x,v.spawnCar.y,v.spawnCar.z, true) < 1.5 then
							interval = 0
							DrawMarker(1,v.spawnCar.x,v.spawnCar.y,v.spawnCar.z - 1, 0, 0, 0, 0, 0, 0, 1.5001, 1.5001, 0.6001,255,0,0, 200, 0, 0, 0, 0)
							drawTxt("EN ESTE SITIO EL MAYORDOMO TE TRAERA EL COCHE",1, 1, 0.5, 0.9, 0.75,255,0,0,255)
						
						elseif GetDistanceBetweenCoords(GetEntityCoords(GetPlayerPed(-1)), v.saveCar.x,v.saveCar.y,v.saveCar.z, true) < 1.5 then
							interval = 0
							DrawMarker(1,v.saveCar.x,v.saveCar.y,v.saveCar.z - 1, 0, 0, 0, 0, 0, 0, 1.5001, 1.5001, 0.6001,255,0,0, 200, 0, 0, 0, 0)
							drawTxt("PON EL COCHE AQUÍ Y AVISA AL MAYORDOMO QUE LO RECOJA EN EL MÚSCULO E",1, 1, 0.5, 0.9, 0.75,255,0,0,255)
							if IsControlJustReleased(0, 38) then
								if IsPedSittingInAnyVehicle(GetPlayerPed(-1)) then
									StockVehicleMenuc()
								else
									TriggerEvent('esx:showNotification', "No hay ningun coche para meter")
								end
							end
						end
					end
				end
			end
			Citizen.Wait(interval)
		end
	end)

end





function OpenMenus()
	elements = {
	
			{label = '<span style="color: beige;">VESTIDOR</span>', value = 'SHUUUAP'},
			{label = '<span style="color: beige;">ARMARIO</span>', value = 'SHUUUUUP'},
	}
	ESX.UI.Menu.CloseAll()

	ESX.UI.Menu.Open('default', GetCurrentResourceName(), 'armory', {
		title    = '<b><span style="color: lightsteelblue;">ARMARIO</span></b>',
		align    = 'top-left',
		elements = elements
	}, function(data, menu)

		if data.current.value == 'SHUUUAP'  then 
			OpenVestidor()
		elseif data.current.value == 'SHUUUUUP' then
			OpenArmoryMenu()
		end

	end, function(data, menu)
		menu.close()
	end)
end


function OpenVestidor()
	
	ESX.TriggerServerCallback('dk:getPlayerDressing', function(dressing)
		local elements = {}

		for i=1, #dressing, 1 do
		  table.insert(elements, {label = dressing[i], value = i})
		end

		ESX.UI.Menu.Open('default', GetCurrentResourceName(), 'player_dressing', {
			title    = '<b><span style="color: lightsteelblue;">VESTIDOR</span></b>',
			align    = 'top-left',
			elements = elements,
		  }, function(data, menu)

			TriggerEvent('skinchanger:getSkin', function(skin)

			  ESX.TriggerServerCallback('dk:getPlayerOutfit', function(clothes)

				TriggerEvent('skinchanger:loadClothes', skin, clothes)
				TriggerEvent('esx_skin:setLastSkin', skin)

				TriggerEvent('skinchanger:getSkin', function(skin)
				  TriggerServerEvent('esx_skin:save', skin)
				end)
				
				ESX.ShowNotification(('¡Ropa personal puesta!'))
				HasLoadCloth = true
			  end, data.current.value)
			end)
		  end, function(data, menu)
			menu.close()
		  end
		)
	  end)
end


function OpenArmoryMenu()
		elements = {
	
			{label = '<span style="color: beige;">SACAR ARMAS</span>', value = 'get_weapon'},
			{label = '<span style="color: beige;">DEPOSITAR ARMAS</span>', value = 'put_weapon'},
			{label = '<span style="color: beige;">SACAR OBJETOS</span>', value = 'get_stock'},
			{label = '<span style="color: beige;">DEPOSITAR OBJETOS</span>', value = 'put_stock'},
			{label = '<span style="color: beige;">DEPOSITAR DINERO NEGRO</span>', value = 'meterpasta'},
			{label = '<span style="color: beige;">RETIRAR DINERO NEGRO</span>', value = 'sacarpasta'}
		}
	ESX.UI.Menu.CloseAll()

	ESX.UI.Menu.Open('default', GetCurrentResourceName(), 'armory', {
		title    = '<b><span style="color: lightsteelblue;">ARMARIO</span></b>',
		align    = 'top-left',
		elements = elements
	}, function(data, menu)

		if data.current.value == 'get_weapon'  then 
			print(group.groupid)
			TriggerServerEvent("draikbandas:preguntosihayalguienmirandoarmariosarmas",group.groupid)
		elseif data.current.value == 'put_weapon' then
			OpenMeterArmas()
		elseif data.current.value == 'put_stock' then
			Abrirmeterobjetos()
		elseif data.current.value == 'get_stock' then
			Abrirsacarobjetos()
		elseif data.current.value == 'meterpasta' then
			Abrirmeterpasta()
		elseif data.current.value == 'sacarpasta' then
			Abrirsacarpasta()
		end

	end, function(data, menu)
		menu.close()
	end)
end



RegisterNetEvent('draikarmarios:JDHSAJHDNIH798JIEB18792JENDUIAI8UDJNAVDB7890DKDJAIDUJQ9IJDSOIADUJN')
AddEventHandler('draikarmarios:JDHSAJHDNIH798JIEB18792JENDUIAI8UDJNAVDB7890DKDJAIDUJQ9IJDSOIADUJN',function()
	Opencoherarmitas()
end)


function deleteCar(entity) 
	ESX.Game.DeleteVehicle(entity) 
end



function IsInVehicle()
  local ply = GetPlayerPed(-1)
  if IsPedSittingInAnyVehicle(ply) then
    return true
  else
    return false
  end
end 

RegisterNetEvent('tm1_mafias:esposar')
AddEventHandler('tm1_mafias:esposar',function(option)
	local closestPlayer, closestDistance = ESX.Game.GetClosestPlayer()
	if closestPlayer ~= -1 and closestDistance <= 3.0 then	
		TriggerServerEvent('tm1_mafias:toClientEsposar',GetPlayerServerId(closestPlayer))
	end
end)

RegisterNetEvent('tm1_mafias:changeEsposar')
AddEventHandler('tm1_mafias:changeEsposar',function(option)
  IsHandcuffed    = option
  local playerPed = GetPlayerPed(-1)

  Citizen.CreateThread(function()

    if IsHandcuffed == true then

      RequestAnimDict('mp_arresting')

      while not HasAnimDictLoaded('mp_arresting') do
        Wait(100)
      end

      TaskPlayAnim(playerPed, 'mp_arresting', 'idle', 8.0, -8, -1, 49, 0, 0, 0, 0)
      SetEnableHandcuffs(playerPed, true)
      SetPedCanPlayGestureAnims(playerPed, false)
      FreezeEntityPosition(playerPed,  true)

    elseif IsHandcuffed == false then

      ClearPedSecondaryTask(playerPed)
      SetEnableHandcuffs(playerPed, false)
      SetPedCanPlayGestureAnims(playerPed,  true)
      FreezeEntityPosition(playerPed, false)

    end

  end)
end)

function StockVehicleMenuc()
		local playerPed  = GetPlayerPed(-1)
		if IsPedSittingInAnyVehicle(playerPed) then
			local vehicle = GetVehiclePedIsIn(GetPlayerPed(-1), false)
			deleteCar(vehicle)
		else
			TriggerEvent('esx:showNotification', 'No hay vehículo para meter')
		end
end



